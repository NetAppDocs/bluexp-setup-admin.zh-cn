---
sidebar: sidebar 
permalink: task-install-connector-azure.html 
keywords: install connector, azure connector installation, azure connector, install connector in azure, bluexp, azure marketplace, manual install, create connector 
summary: 直接从基于Web的BlueXP控制台、Azure Marketplace或通过在您自己的Linux主机上安装软件来创建Connector。 
---
= 在 Azure 中创建连接器
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
直接从基于Web的BlueXP控制台、Azure Marketplace或通过在您自己的Linux主机上安装软件来创建Connector。

[role="tabbed-block"]
====
.BlueXP
--
.开始之前
您应具备以下条件：

* Azure 订阅。
* 您选择的 Azure 区域中的 vNet 和子网。
* 有关代理服务器的详细信息、如果您的组织需要代理来处理所有传出Internet流量：
+
** IP 地址
** 凭据
** HTTPS证书


* SSH公共密钥(如果要对Connector虚拟机使用该身份验证方法)。身份验证方法的另一个选项是使用密码。
+
https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux["了解如何在Azure中连接到Linux VM"^]

* 如果您不希望BlueXP自动为Connector创建Azure角色、则需要创建您自己的角色 link:reference-permissions-azure.html["使用此页面上的策略"]。
+
这些权限适用于 Connector 实例本身。它是一组与您先前设置的权限不同的权限，只需部署 Connector 即可。



.步骤
. 如果要创建首个工作环境，请单击 * 添加工作环境 * 并按照提示进行操作。否则，请单击 * 连接器 * 下拉列表并选择 * 添加连接器 * 。
+
image:screenshot_connector_add.gif["标题中显示 Connector 图标和 Add Connector 操作的屏幕截图。"]

. 选择 * Microsoft Azure* 作为云提供商。
. 在*部署连接器*页面上：
+
.. 在*身份验证*下、选择与您设置Azure权限的方式匹配的身份验证选项：
+
*** 选择* Azure用户帐户*以登录到您的Microsoft帐户、该帐户应具有所需的权限。
+
此表由 Microsoft 拥有和托管。您的凭据不会提供给 NetApp 。

+

TIP: 如果您已登录到Azure帐户、则BlueXP将自动使用该帐户。如果您有多个帐户，则可能需要先注销，以确保您使用的是正确的帐户。

*** 选择* Active Directory服务主体*以输入有关授予所需权限的Azure Active Directory服务主体的信息：
+
**** 应用程序(客户端) ID
**** 目录(租户) ID
**** 客户端密钥






+
link:task-set-up-permissions-azure.html["了解如何为服务主体获取这些值"]。

. 按照向导中的步骤创建 Connector ：
+
** *VM身份验证*：选择Azure订阅、位置、新资源组或现有资源组，然后为要创建的Connector虚拟机选择身份验证方法。
+
虚拟机的身份验证方法可以是密码或SSH公共密钥。

+
https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux["了解如何在Azure中连接到Linux VM"^]

** *详细信息*：输入实例的名称、指定标记、然后选择是希望BlueXP创建具有所需权限的新角色、还是要选择使用设置的现有角色 link:reference-permissions-azure.html["所需权限"]。
+
请注意、您可以选择与此角色关联的Azure订阅。您选择的每个订阅都提供连接器权限、用于管理该订阅中的资源(例如Cloud Volumes ONTAP)。

** * 网络 * ：选择 vNet 和子网，是否启用公有 IP 地址，并可选择指定代理配置。
** *安全组*：选择是创建新安全组还是选择允许所需入站和出站规则的现有安全组。
+
link:reference-ports-azure.html["查看Azure的安全组规则"]。

** * 审核 * ：查看您选择的内容，确认您的设置正确无误。


. 单击 * 添加 * 。
+
虚拟机应在大约 7 分钟内准备就绪。您应停留在页面上，直到此过程完成。



.结果
此过程完成后、即可从BlueXP使用Connector。

--
.Azure Marketplace
--
.步骤
. 转到Azure Marketplace中的NetApp Connector VM页面。
+
https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.netapp-oncommand-cloud-manager["适用于商业区域的Azure Marketplace页面"^]

. 单击 * 立即获取 * ，然后单击 * 继续 * 。
. 在 Azure 门户中，单击 * 创建 * ，然后按照步骤配置虚拟机。
+
配置虚拟机时，请注意以下事项：

+
** *虚拟机大小*：选择满足CPU和RAM要求的虚拟机大小。我们建议使用 DS3 v2 。
** *磁盘*：此连接器可以对HDD或SSD磁盘执行最佳性能。
** *网络安全组*：Connector需要使用SSH、HTTP和HTTPS进行入站连接。
+
link:reference-ports-azure.html["查看Azure的安全组规则"]。

** *身份*：在*管理*下、选择*启用系统分配的受管身份*。
+
此设置非常重要，因为托管身份允许 Connector 虚拟机在不提供任何凭据的情况下向 Azure Active Directory 标识自己。 https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["详细了解 Azure 资源的托管身份"^]。



. 在 * 查看 + 创建 * 页面上，查看所做的选择并单击 * 创建 * 以开始部署。
+
Azure 使用指定的设置部署虚拟机。虚拟机和 Connector 软件应在大约五分钟内运行。

. 从已连接到 Connector 虚拟机的主机打开 Web 浏览器，然后输入以下 URL ：
+
https://_ipaddress_[]

. 登录后，设置 Connector ：
+
.. 指定要与Connector关联的BlueXP帐户。
.. 输入系统名称。
.. 在*是否在安全环境中运行？*下、保持禁用受限模式。
+
您应始终禁用受限模式、因为这些步骤说明了如何在标准模式下使用BlueXP。只有在您拥有安全环境并希望将此帐户与BlueXP后端服务断开连接时、才应启用受限模式。如果是这种情况、 link:task-quick-start-restricted-mode.html["按照步骤在受限模式下开始使用BlueXP"]。

.. 单击*我们开始*。




现在、Connector已安装完毕、并已使用您的BlueXP帐户进行设置。

.下一步是什么？
link:task-provide-permissions-azure.html["为BlueXP提供您先前设置的权限"]。

--
.手动安装
--
.开始之前
您应具备以下条件：

* 安装Connector的root权限。
* 有关代理服务器的详细信息、如果从Connector访问Internet需要代理。
+
您可以选择在安装后配置代理服务器、但这样做需要重新启动Connector。

* CA签名证书、如果代理服务器使用HTTPS或代理是截获代理。
* 在Azure中的虚拟机上启用的托管身份、以便您可以通过自定义角色提供所需的Azure权限。
+
https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm["Microsoft Azure文档：使用Azure门户为虚拟机上的Azure资源配置托管身份"^]



.关于此任务
NetApp 支持站点上提供的安装程序可能是早期版本。安装后，如果有新版本可用， Connector 会自动进行更新。

.步骤
. 验证 Docker 是否已启用且正在运行。
+
[source, cli]
----
sudo systemctl enable docker && sudo systemctl start docker
----
. 如果在主机上设置了_http_proxy_或_https_proxy_系统变量、请将其删除：
+
[source, cli]
----
unset http_proxy
unset https_proxy
----
+
如果不删除这些系统变量、安装将失败。

. 从下载Connector软件 https://mysupport.netapp.com/site/products/all/details/cloud-manager/downloads-tab["NetApp 支持站点"^]，然后将其复制到 Linux 主机。
+
您应下载用于您的网络或云中的"联机"Connector安装程序。Connector可以使用单独的"脱机"安装程序、但只有专用模式部署才支持此安装程序。

. 分配运行脚本的权限。
+
[source, cli]
----
chmod +x OnCommandCloudManager-<version>
----
+
其中、<version> 是您下载的连接器版本。

. 运行安装脚本。
+
[source, cli]
----
 ./OnCommandCloudManager-<version> --proxy <HTTP or HTTPS proxy server> --cacert <path and file name of a CA-signed certificate>
----
+
-proxy和-cacert参数是可选的。如果您有代理服务器、则需要输入所示的参数。安装程序不会提示您提供有关代理的信息。

+
以下是使用这两个可选参数的命令示例：

+
[source, cli]
----
 ./OnCommandCloudManager-V3.9.26 --proxy https://user:password@10.0.0.30:8080/ --cacert /tmp/cacert/certificate.cer
----
+
-proxy会将Connector配置为使用以下格式之一的HTTP或HTTPS代理服务器：

+
** \http://address:port
** \http://username:password@address:port
** \https://address:port
** \https://username:password@address:port
+
用户必须是本地用户。不支持域用户。



+
-cacert指定用于在Connector和代理服务器之间进行HTTPS访问的CA签名证书。只有在指定HTTPS代理服务器或代理为截获代理时、才需要此参数。

. 等待安装完成。
+
在安装结束时、如果您指定了代理服务器、则Connector服务(occa)将重新启动两次。

. 从已连接到 Connector 虚拟机的主机打开 Web 浏览器，然后输入以下 URL ：
+
https://_ipaddress_[]

. 登录后，设置 Connector ：
+
.. 指定要与Connector关联的BlueXP帐户。
.. 输入系统名称。
.. 在*是否在安全环境中运行？*下、保持禁用受限模式。
+
您应始终禁用受限模式、因为这些步骤说明了如何在标准模式下使用BlueXP。只有在您拥有安全环境并希望将此帐户与BlueXP后端服务断开连接时、才应启用受限模式。如果是这种情况、 link:task-quick-start-restricted-mode.html["按照步骤在受限模式下开始使用BlueXP"]。

.. 单击*我们开始*。




.结果
现在、Connector已安装完毕、并已使用您的BlueXP帐户进行设置。

.下一步是什么？
link:task-provide-permissions-azure.html["为BlueXP提供您先前设置的权限"]。

--
====
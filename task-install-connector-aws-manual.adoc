---
sidebar: sidebar 
permalink: task-install-connector-aws-manual.html 
keywords: install connector, aws connector installation, aws connector, install connector in aws, bluexp, aws marketplace, manual install, create connector 
summary: 要在您自己的Linux主机上手动安装Connector、您需要查看主机要求、设置网络连接、准备AWS权限、安装Connector、然后提供准备好的权限。 
---
= 在AWS中手动安装Connector
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
要在您自己的Linux主机上手动安装Connector、您需要查看主机要求、设置网络连接、准备AWS权限、安装Connector、然后提供准备好的权限。

.开始之前
您应查看 link:reference-limitations.html["连接器限制"]。



== 第1步：查看主机要求

连接器软件必须在满足特定操作系统要求， RAM 要求，端口要求等要求的主机上运行。

专用主机:: 与其他应用程序共享的主机不支持此连接器。主机必须是专用主机。
支持的操作系统::
+
--
* Ubuntu 22.04 LTS
* Red Hat Enterprise Linux
+
** 8.6至8.9
** 9.1至9.3
+
主机必须已注册到Red Hat订阅管理。如果未注册、则主机无法在安装Connector期间访问存储库以更新所需的第三方软件。

+
这些操作系统的英语版本支持 Connector 。





--
虚拟机管理程序:: 需要一个经过认证可运行受支持操作系统的裸机或托管虚拟机管理程序。
CPU:: 4 个核心或 4 个 vCPU
RAM:: 14 GB
AWS EC2 实例类型:: 满足上述 CPU 和 RAM 要求的实例类型。我们建议使用 T3.xlarge 。
密钥对:: 创建连接器时、您需要选择要用于实例的EC2密钥对。
/opt 中的磁盘空间:: 必须有 100 GiB 的可用空间
+
--
BlueXP使用 `/opt` 安装 `/opt/application/netapp` 目录及其内容。

--
/var 中的磁盘空间:: 必须有20 GiB的可用空间
+
--
BlueXP需要中的此空间 `/var` 因为Docker或Podman的架构设计是为了在此目录中创建容器。具体来说、他们将在中创建容器 `/var/lib/containers/storage` 目录。外部挂载或符号链接不适用于此空间。

--
容器流程编排工具:: 根据您的操作系统、在安装Connector之前需要使用Podman或Docker引擎。
+
--
* Red Hat Enterprise Linux 8和9需要Podman 4.6.1版。
+
Podman必须满足以下前提条件：

+
** 必须启用并启动Podman.sSocket服务
** 必须安装python3
** 必须安装Podman-compose软件包1.0.6版
** 必须将Podman-compose添加到PATH环境变量中


* Ubuntu需要Docker引擎。
+
** 支持的最低版本为23.0.6。
** 支持的最大版本为25.0.5。




--




== 第2步：安装Podman或Docker引擎

根据您的操作系统、在安装Connector之前需要使用Podman或Docker引擎。

* Red Hat Enterprise Linux 8和9需要Podman。
* Ubuntu需要Docker引擎。


.步骤
[role="tabbed-block"]
====
.Podman
--
安装Podman 4.6.1。

.步骤
. 如果在主机上安装了Podman-Docker软件包、请将其删除。
+
[source, cli]
----
dnf remove podman-docker
rm /var/run/docker.sock
----
. 安装Podman。
+
Podman可从Red Hat Enterprise Linux官方存储库获得。

+
对于Red Hat Enterprise Linux 9：

+
[source, cli]
----
sudo dnf install podman-2:4.6.1
----
+
对于Red Hat Enterprise Linux 8：

+
[source, cli]
----
sudo dnf install podman-3:4.6.1
----
. 启用并启动Podman.sSocket服务。
+
[source, cli]
----
sudo systemctl enable --now podman.socket
----
. 安装python3.
+
[source, cli]
----
sudo dnf install python3
----
. 如果您的系统上尚未提供EPEL存储库包、请安装该软件包。
+
之所以需要执行此步骤、是因为可以从Enterprise Linux的额外软件包(EPEL)存储库中进行podman-compose。

+
对于Red Hat Enterprise Linux 9：

+
[source, cli]
----
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm
----
+
对于Red Hat Enterprise Linux 8：

+
[source, cli]
----
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
----
. 安装podman-compose软件包1.0.6。
+
[source, cli]
----
sudo dnf install podman-compose-1.0.6
----
+

NOTE: 使用 `dnf install` 命令可满足向PATH环境变量添加Podman-compose的要求。安装命令会将podman-compose添加到/usr/bin中、该文件已包含在中 `secure_path` 选项。



--
.Docker 引擎
--
安装介于23.0.6和21.0.5之间的Docker引擎版本。

.步骤
. 安装Docker引擎。
+
https://docs.docker.com/engine/install/["从Docker查看安装说明"^]

+
请务必按照以下步骤安装特定版本的Docker引擎。安装最新版本将安装BlueXP不支持的Docker版本。

. 确认Docker已启用且正在运行。
+
[source, cli]
----
sudo systemctl enable docker && sudo systemctl start docker
----


--
====


== 第3步：设置网络

确保您计划安装Connector的网络位置符合以下要求。满足这些要求后、Connector便可管理混合云环境中的资源和流程。

连接到目标网络:: Connector需要与您计划创建和管理工作环境的位置建立网络连接。例如、您计划在内部环境中创建Cloud Volumes ONTAP系统或存储系统的网络。


出站 Internet 访问:: 部署连接器的网络位置必须具有出站Internet连接才能联系特定端点。


在手动安装期间访问的端点:: 在您自己的Linux主机上手动安装Connector时、Connector安装程序需要在安装过程中访问以下URL：
+
--
* \https://support.netapp.com
* \https://mysupport.netapp.com
* \https://cloudmanager.cloud.netapp.com/tenancy
* \https://stream.cloudmanager.cloud.netapp.com
* \https://production-artifacts.cloudmanager.cloud.netapp.com
* \https://*.blob.core.windows.net
* \https://cloudmanagerinfraprod.azurecr.io
+
主机可能会在安装期间尝试更新操作系统软件包。主机可以联系这些操作系统软件包的不同镜像站点。



--


从连接器连接的端点:: Connector需要通过出站Internet访问与以下端点联系、以便管理公共云环境中的资源和流程、以实现日常运营。
+
--
请注意、下面列出的端点均为CNAME条目。

[cols="2a,1a"]
|===
| 端点 | 目的 


 a| 
AWS 服务（ AmazonAWS.com ）：

* 云形成
* 弹性计算云（ EC2 ）
* 身份和访问管理(IAM)
* 密钥管理服务（ KMS ）
* 安全令牌服务（ STS ）
* 简单存储服务 (S3)

 a| 
管理AWS中的资源。确切的端点取决于您使用的AWS区域。 https://docs.aws.amazon.com/general/latest/gr/rande.html["有关详细信息、请参见AWS文档"^]



 a| 
https://support.netapp.com
https://mysupport.netapp.com
 a| 
获取许可信息并向 NetApp 支持部门发送 AutoSupport 消息。



 a| 
\https://*.api.bluexp.netapp.com

\https://api.bluexp.netapp.com

\https://*.cloudmanager.cloud.netapp.com

\https://cloudmanager.cloud.netapp.com

\https://netapp-cloud-account.auth0.com
 a| 
在BlueXP中提供SaaS功能和服务。

请注意、Connector目前正在联系cloudmanager.cloud.netapp.com"、但在即将发布的版本中、它将开始联系api.bluexp.netapp.com"。



 a| 
\https://*.blob.core.windows.net

\https://cloudmanagerinfraprod.azurecr.io
 a| 
升级 Connector 及其 Docker 组件。

|===
--


代理服务器:: 如果您的组织需要为所有传出Internet流量部署代理服务器、请获取有关HTTP或HTTPS代理的以下信息。您需要在安装期间提供此信息。请注意、BlueXP不支持透明代理服务器。
+
--
* IP 地址
* 凭据
* HTTPS证书


--


端口:: 除非您启动连接器或将连接器用作代理将AutoSupport消息从Cloud Volumes ONTAP发送到NetApp支持、否则不会有传入连接器的流量。
+
--
* 通过 HTTP （ 80 ）和 HTTPS （ 443 ），您可以访问本地 UI ，在极少数情况下，您可以使用此界面。
* 只有在需要连接到主机进行故障排除时，才需要使用 SSH （ 22 ）。
* 如果您在出站Internet连接不可用的子网中部署Cloud Volumes ONTAP 系统、则需要通过端口3128进行入站连接。
+
如果Cloud Volumes ONTAP系统没有用于发送AutoSupport消息的出站Internet连接、BlueXP会自动将这些系统配置为使用连接器附带的代理服务器。唯一的要求是确保Connector的安全组允许通过端口3128进行入站连接。部署Connector后、您需要打开此端口。



--


启用NTP:: 如果您计划使用BlueXP分类来扫描公司数据源、则应在BlueXP Connector系统和BlueXP分类系统上启用网络时间协议(Network Time Protocol、NTP)服务、以便在系统之间同步时间。 https://docs.netapp.com/us-en/bluexp-classification/concept-cloud-compliance.html["了解有关BlueXP分类的更多信息"^]




== 第4步：设置权限

您需要使用以下选项之一为BlueXP提供AWS权限：

* 选项1：创建IAM策略并将这些策略附加到可以与EC2实例关联的IAM角色。
* 选项2：为BlueXP提供具有所需权限的IAM用户的AWS访问密钥。


按照以下步骤准备BlueXP的权限。

[role="tabbed-block"]
====
.IAM角色
--
.步骤
. 登录到AWS控制台并导航到IAM服务。
. 创建策略：
+
.. 选择*策略>创建策略*。
.. 选择*。JSON*、然后复制并粘贴的内容 link:reference-permissions-aws.html["Connector的IAM策略"]。
.. 完成其余步骤以创建策略。
+
根据您计划使用的BlueXP服务、您可能需要创建第二个策略。对于标准区域、权限会分布在两个策略中。由于AWS中受管策略的字符大小上限、因此需要使用两个策略。 link:reference-permissions-aws.html["详细了解Connector的IAM策略"]。



. 创建IAM角色：
+
.. 选择*角色>创建角色*。
.. 选择* AWS服务> EC2*。
.. 通过附加刚刚创建的策略来添加权限。
.. 完成其余步骤以创建角色。




.结果
现在、您可以在安装Connector后将IAM角色与EC2实例关联。

--
.AWS访问密钥
--
.步骤
. 登录到AWS控制台并导航到IAM服务。
. 创建策略：
+
.. 选择*策略>创建策略*。
.. 选择*。JSON*、然后复制并粘贴的内容 link:reference-permissions-aws.html["Connector的IAM策略"]。
.. 完成其余步骤以创建策略。
+
根据您计划使用的BlueXP服务、您可能需要创建第二个策略。

+
对于标准区域、权限会分布在两个策略中。由于AWS中受管策略的字符大小上限、因此需要使用两个策略。 link:reference-permissions-aws.html["详细了解Connector的IAM策略"]。



. 将策略附加到IAM用户。
+
** https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create.html["AWS 文档：创建 IAM 角色"^]
** https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html["AWS 文档：添加和删除 IAM 策略"^]


. 确保用户具有可在安装Connector后添加到BlueXP的访问密钥。


.结果
您现在拥有一个IAM用户、该用户具有所需权限、并具有一个可提供给BlueXP的访问密钥。

--
====


== 第5步：安装连接器

完成前提条件后、您可以在自己的Linux主机上手动安装软件。

.开始之前
您应具备以下条件：

* 安装Connector的root权限。
* 有关代理服务器的详细信息、如果从Connector访问Internet需要代理。
+
您可以选择在安装后配置代理服务器、但这样做需要重新启动Connector。

+
请注意、BlueXP不支持透明代理服务器。

* CA签名证书、如果代理服务器使用HTTPS或代理是截获代理。


.关于此任务
NetApp 支持站点上提供的安装程序可能是早期版本。安装后，如果有新版本可用， Connector 会自动进行更新。

.步骤
. 如果在主机上设置了_http_proxy_或_https_proxy_系统变量、请将其删除：
+
[source, cli]
----
unset http_proxy
unset https_proxy
----
+
如果不删除这些系统变量、安装将失败。

. 从下载Connector软件 https://mysupport.netapp.com/site/products/all/details/cloud-manager/downloads-tab["NetApp 支持站点"^]，然后将其复制到 Linux 主机。
+
您应下载用于您的网络或云中的"联机"Connector安装程序。Connector可以使用单独的"脱机"安装程序、但只有专用模式部署才支持此安装程序。

. 分配运行脚本的权限。
+
[source, cli]
----
chmod +x BlueXP-Connector-Cloud-<version>
----
+
其中、<version> 是您下载的连接器版本。

. 运行安装脚本。
+
[source, cli]
----
 ./BlueXP-Connector-Cloud-<version> --proxy <HTTP or HTTPS proxy server> --cacert <path and file name of a CA-signed certificate>
----
+
-proxy和-cacert参数是可选的。如果您有代理服务器、则需要输入所示的参数。安装程序不会提示您提供有关代理的信息。

+
以下是使用这两个可选参数的命令示例：

+
[source, cli]
----
 ./BlueXP-Connector-Cloud-v3.9.40--proxy https://user:password@10.0.0.30:8080/ --cacert /tmp/cacert/certificate.cer
----
+
-proxy会将Connector配置为使用以下格式之一的HTTP或HTTPS代理服务器：

+
** \http://address:port
** \http://user-name:password@address:port
** \http://domain-name%92user-name:password@address:port
** \https://address:port
** \https://user-name:password@address:port
** \https://domain-name%92user-name:password@address:port
+
请注意以下事项：

+
*** 用户可以是本地用户或域用户。
*** 对于域用户、必须对\使用ASCII代码、如上所示。
*** BlueXP不支持包含@字符的用户名或密码。
*** 如果密码包含以下任一特殊字符，则必须在该特殊字符前面加上反斜杠：&或!
+
例如：

+
\http://bxpproxyuser:netapp1\!@address:3128





+
-cacert指定用于在Connector和代理服务器之间进行HTTPS访问的CA签名证书。只有在指定HTTPS代理服务器或代理为截获代理时、才需要此参数。

. 等待安装完成。
+
在安装结束时、如果您指定了代理服务器、则Connector服务(occa)将重新启动两次。

. 从已连接到 Connector 虚拟机的主机打开 Web 浏览器，然后输入以下 URL ：
+
https://_ipaddress_[]

. 登录后，设置 Connector ：
+
.. 指定要与Connector关联的BlueXP帐户。
.. 输入系统名称。
.. 在*是否在安全环境中运行？*下、保持禁用受限模式。
+
您应始终禁用受限模式、因为这些步骤说明了如何在标准模式下使用BlueXP。只有在您拥有安全环境并希望将此帐户与BlueXP后端服务断开连接时、才应启用受限模式。如果是这种情况、 link:task-quick-start-restricted-mode.html["按照步骤在受限模式下开始使用BlueXP"]。

.. 选择*开始*。




.结果
现在、Connector已安装完毕、并已使用您的BlueXP帐户进行设置。

如果您在创建Connector的同一AWS帐户中具有Amazon S3存储分段、则会在BlueXP画布上自动显示Amazon S3工作环境。 https://docs.netapp.com/us-en/bluexp-s3-storage/index.html["了解如何从BlueXP管理S3存储分段"^]



== 第6步：为BlueXP提供权限

现在您已安装Connector、您需要为BlueXP提供先前设置的AWS权限。通过提供权限、BlueXP可以在AWS中管理数据和存储基础架构。

[role="tabbed-block"]
====
.IAM角色
--
将先前创建的IAM角色附加到Connector EC2实例。

.步骤
. 转到Amazon EC2控制台。
. 选择*实例*。
. 选择Connector实例。
. 选择*操作>安全性>修改IAM角色*。
. 选择IAM角色并选择*更新IAM角色*。


.结果
现在、BlueXP拥有代表您在AWS中执行操作所需的权限。

转至 https://console.bluexp.netapp.com["BlueXP控制台"^] 开始将Connector与BlueXP结合使用。

--
.AWS访问密钥
--
为BlueXP提供具有所需权限的IAM用户的AWS访问密钥。

.步骤
. 确保当前在BlueXP中选择了正确的Connector。
. 在BlueXP控制台的右上角、选择设置图标、然后选择*凭据*。
+
image:screenshot_settings_icon.gif["一个屏幕截图、显示了BlueXP控制台右上角的设置图标。"]

. 选择*添加凭据*并按照向导中的步骤进行操作。
+
.. * 凭据位置 * ：选择 * Amazon Web Services > Connector* 。
.. *定义凭据*：输入AWS访问密钥和机密密钥。
.. * 市场订阅 * ：通过立即订阅或选择现有订阅，将市场订阅与这些凭据相关联。
.. *查看*：确认有关新凭据的详细信息、然后选择*添加*。




.结果
现在、BlueXP拥有代表您在AWS中执行操作所需的权限。

转至 https://console.bluexp.netapp.com["BlueXP控制台"^] 开始将Connector与BlueXP结合使用。

--
====
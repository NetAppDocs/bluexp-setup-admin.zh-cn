---
sidebar: sidebar 
permalink: task-set-up-permissions-on-prem.html 
keywords: set up permissions, cloud permissions, aws permissions, azure permissions, on prem permissions, connector permissions 
summary: 如果要将AWS或Azure中的BlueXP服务与内部连接器结合使用、则需要在云提供商中设置权限、以便在安装此连接器后将凭据添加到其中。 
---
= 为内部部署设置云权限
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
如果要将AWS或Azure中的BlueXP服务与内部部署的Connector结合使用、则需要在云提供程序中设置权限、以便可以在安装Connector后将凭据添加到Connector。


TIP: 为什么不选择Google Cloud？如果在您的内部安装了Connector、则它无法在Google Cloud中管理您的资源。必须在Google Cloud中安装Connector、才能管理驻留在其中的任何资源。

[role="tabbed-block"]
====
.AWS
--
在内部安装Connector时、您需要通过为具有所需权限的IAM用户添加访问密钥来为BlueXP提供AWS权限。

如果Connector安装在内部、则必须使用此身份验证方法。您不能使用IAM角色。

.步骤
. 从IAM控制台中、创建策略：
+
.. 单击*策略>创建策略*。
.. 选择*。JSON*、然后复制并粘贴的内容 link:reference-permissions-aws.html["Connector的IAM策略"]。
.. 完成其余步骤以创建策略。
+
根据您计划使用的BlueXP服务、您可能需要创建第二个策略。

+
对于标准区域、权限会分布在两个策略中。由于AWS中受管策略的字符大小上限、因此需要使用两个策略。 link:reference-permissions-aws.html["详细了解Connector的IAM策略"]。



. 将策略附加到IAM用户。
+
** https://["AWS 文档：创建 IAM 角色"^]
** https://["AWS 文档：添加和删除 IAM 策略"^]


. 确保用户具有可在安装Connector后添加到BlueXP中的访问密钥。


.结果
现在、您应该拥有具有所需权限的IAM用户的访问密钥。安装Connector后、您需要将这些凭据与BlueXP中的Connector相关联。

link:task-provide-permissions-on-prem.html["了解如何为BlueXP提供这些权限"]。

--
.Azure 酒店
--
在内部安装Connector时、您需要通过在Azure Active Directory中设置服务主体并获取BlueXP所需的Azure凭据来为BlueXP提供Azure权限。

.创建Azure Active Directory应用程序以进行基于角色的访问控制
. 确保您在Azure中拥有创建Active Directory应用程序和将应用程序分配给角色的权限。
+
有关详细信息，请参见 https://["Microsoft Azure 文档：所需权限"^]。

. 从 Azure 门户中，打开 * Azure Active Directory* 服务。
+
image:screenshot_azure_ad.gif["显示了 Microsoft Azure 中的 Active Directory 服务。"]

. 在菜单中，单击 * 应用程序注册 * 。
. 单击 * 新建注册 * 。
. 指定有关应用程序的详细信息：
+
** * 名称 * ：输入应用程序的名称。
** *帐户类型*：选择帐户类型(任何将适用于BlueXP)。
** * 重定向 URI* ：可以将此字段留空。


. 单击 * 注册 * 。
+
您已创建 AD 应用程序和服务主体。



.将应用程序分配给角色
. 创建自定义角色：
+
.. 复制的内容 link:reference-permissions-azure.html["Connector的自定义角色权限"] 并将其保存在JSON文件中。
.. 通过将 Azure 订阅 ID 添加到可分配范围来修改 JSON 文件。
+
您应该为每个 Azure 订阅添加 ID 、用户将从中创建 Cloud Volumes ONTAP 系统。

+
* 示例 *

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
.. 使用 JSON 文件在 Azure 中创建自定义角色。
+
以下步骤介绍如何在 Azure Cloud Shell 中使用 Bash 创建角色。

+
*** start https://["Azure Cloud Shell"^] 并选择 Bash 环境。
*** 上传 JSON 文件。
+
image:screenshot_azure_shell_upload.png["Azure Cloud Shell 的屏幕截图，您可以在其中选择上传文件的选项。"]

*** 使用Azure命令行界面创建自定义角色：
+
[source, azurecli]
----
az role definition create --role-definition Connector_Policy.json
----
+
现在、您应该拥有一个名为BlueXP操作员的自定义角色、可以将该角色分配给Connector虚拟机。





. 将应用程序分配给角色：
+
.. 从 Azure 门户中，打开 * 订阅 * 服务。
.. 选择订阅。
.. 单击 * 访问控制（ IAM ） > 添加 > 添加角色分配 * 。
.. 在*角色*选项卡中、选择* BlueXP操作员*角色、然后单击*下一步*。
.. 在 * 成员 * 选项卡中，完成以下步骤：
+
*** 保持选中 * 用户，组或服务主体 * 。
*** 单击 * 选择成员 * 。
+
image:screenshot-azure-service-principal-role.png["Azure 门户的屏幕截图，显示向应用程序添加角色时的成员选项卡。"]

*** 搜索应用程序的名称。
+
以下是一个示例：

+
image:screenshot_azure_service_principal_role.png["Azure 门户的屏幕截图，其中显示了 Azure 门户中的添加角色分配表。"]

*** 选择应用程序并单击 * 选择 * 。
*** 单击 * 下一步 * 。


.. 单击 * 审核 + 分配 * 。
+
现在，服务主体具有部署 Connector 所需的 Azure 权限。

+
如果要从多个 Azure 订阅部署 Cloud Volumes ONTAP ，则必须将服务主体绑定到每个订阅。通过BlueXP、您可以选择要在部署Cloud Volumes ONTAP 时使用的订阅。





.添加 Windows Azure 服务管理 API 权限
. 在 * Azure Active Directory* 服务中，单击 * 应用程序注册 * 并选择应用程序。
. 单击 * API 权限 > 添加权限 * 。
. 在 * Microsoft APIs* 下，选择 * Azure Service Management* 。
+
image:screenshot_azure_service_mgmt_apis.gif["Azure 门户的屏幕截图，其中显示了 Azure 服务管理 API 权限。"]

. 单击 * 以组织用户身份访问 Azure 服务管理 * ，然后单击 * 添加权限 * 。
+
image:screenshot_azure_service_mgmt_apis_add.gif["Azure 门户的屏幕截图，显示如何添加 Azure 服务管理 API 。"]



.获取应用程序的应用程序ID和目录ID
. 在 * Azure Active Directory* 服务中，单击 * 应用程序注册 * 并选择应用程序。
. 复制 * 应用程序（客户端） ID* 和 * 目录（租户） ID* 。
+
image:screenshot_azure_app_ids.gif["显示 Azure Active Directory 中某个应用程序的应用程序（客户端） ID 和目录（租户） ID 的屏幕截图。"]

+
将Azure帐户添加到BlueXP时、您需要提供应用程序(客户端) ID和目录(租户) ID。BlueXP使用ID以编程方式登录。



.创建客户端密钥
. 打开 * Azure Active Directory* 服务。
. 单击 * 应用程序注册 * 并选择您的应用程序。
. 单击 * 证书和密码 > 新客户端密钥 * 。
. 提供密钥和持续时间的问题描述。
. 单击 * 添加 * 。
. 复制客户端密钥的值。
+
image:screenshot_azure_client_secret.gif["Azure 门户的屏幕截图，其中显示了 Azure AD 服务主体的客户端密钥。"]

+
您现在拥有一个客户端密钥、BlueXP可以使用它向Azure AD进行身份验证。



.结果
此时，您的服务主体已设置完毕，您应已复制应用程序（客户端） ID ，目录（租户） ID 和客户端密钥值。安装Connector后、您需要将这些凭据与BlueXP中的Connector相关联。

link:task-provide-permissions-on-prem.html["了解如何为BlueXP提供这些权限"]。

--
====
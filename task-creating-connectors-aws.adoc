---
sidebar: sidebar 
permalink: task-creating-connectors-aws.html 
keywords: fsx for ontap, iam, user role, create connector in aws, launch connector in aws, deploy connector in aws, aws connector, connector aws, connector permissions 
summary: 在使用大多数BlueXP功能之前、BlueXP帐户管理员需要先部署Connector。借助此连接器、BlueXP可以管理公有 云环境中的资源和流程。 
---
= 从BlueXP在AWS中创建连接器
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
BlueXP帐户管理员需要先部署_Connector_、然后才能使用大多数BlueXP功能。借助此连接器、BlueXP可以管理公有 云环境中的资源和流程。

以下步骤介绍如何直接从BlueXP SaaS网站在AWS商业区域中创建Connector。

* link:task-create-connectors-gov.html["了解如何在政府区域部署Connector"]
* link:concept-connectors.html#how-to-create-a-connector["了解部署 Connector 的其他方法"]




== 快速入门

按照以下步骤快速入门，或者向下滚动到其余部分以了解完整详细信息。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["一个"] 设置身份验证
[role="quick-margin-para"]
要在AWS中启动Connector、BlueXP需要通过承担IAM角色或使用AWS访问密钥向AWS进行身份验证。使用任一选项、都需要IAM策略。

[role="quick-margin-para"]
<<创建IAM策略,查看IAM角色>> 或 <<设置 AWS 身份验证,按照分步说明进行操作>>。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["两个"] 设置网络
[role="quick-margin-para"]
您需要一个VPC和子网、并可通过出站Internet访问特定端点。如果出站Internet需要代理服务器、则需要IP地址、凭据和HTTPS证书。

[role="quick-margin-para"]
<<设置网络,查看网络连接要求>>。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["三个"] 创建Connector
[role="quick-margin-para"]
单击Connector下拉列表、选择*添加连接器*、然后按照提示进行操作。

[role="quick-margin-para"]
<<创建连接器,按照分步说明进行操作>>。



== 设置 AWS 身份验证

BlueXP需要先向AWS进行身份验证、然后才能在VPC中部署Connector实例。您可以选择以下身份验证方法之一：

* 让BlueXP承担具有所需权限的IAM角色
* 为具有所需权限的IAM用户提供AWS访问密钥和机密密钥


无论选择哪一种方式、您都需要首先创建一个包含所需权限的IAM策略。



=== 创建IAM策略

此策略仅包含从BlueXP在AWS中启动Connector实例所需的权限。请勿在其他情况下使用此策略。

当BlueXP创建Connector时、它会将一组新的权限应用于Connector实例、从而使Connector能够管理公有 云环境中的资源。

.步骤
. 转到AWS IAM控制台。
. 单击*策略>创建策略*。
. 单击*。JSON*。
. 复制并粘贴以下策略：
+
[source, json]
----
{
    "Version": "2012-10-17",
    "Statement": [{
            "Effect": "Allow",
            "Action": [
                "iam:CreateRole",
                "iam:DeleteRole",
                "iam:PutRolePolicy",
                "iam:CreateInstanceProfile",
                "iam:DeleteRolePolicy",
                "iam:AddRoleToInstanceProfile",
                "iam:RemoveRoleFromInstanceProfile",
                "iam:DeleteInstanceProfile",
                "iam:PassRole",
                "ec2:DescribeInstanceStatus",
                "ec2:RunInstances",
                "ec2:ModifyInstanceAttribute",
                "ec2:CreateSecurityGroup",
                "ec2:DeleteSecurityGroup",
                "ec2:DescribeSecurityGroups",
                "ec2:RevokeSecurityGroupEgress",
                "ec2:AuthorizeSecurityGroupEgress",
                "ec2:AuthorizeSecurityGroupIngress",
                "ec2:RevokeSecurityGroupIngress",
                "ec2:CreateNetworkInterface",
                "ec2:DescribeNetworkInterfaces",
                "ec2:DeleteNetworkInterface",
                "ec2:ModifyNetworkInterfaceAttribute",
                "ec2:DescribeSubnets",
                "ec2:DescribeVpcs",
                "ec2:DescribeDhcpOptions",
                "ec2:DescribeKeyPairs",
                "ec2:DescribeRegions",
                "ec2:DescribeInstances",
                "ec2:CreateTags",
                "ec2:DescribeImages",
                "cloudformation:CreateStack",
                "cloudformation:DeleteStack",
                "cloudformation:DescribeStacks",
                "cloudformation:DescribeStackEvents",
                "cloudformation:ValidateTemplate",
                "ec2:AssociateIamInstanceProfile",
                "ec2:DescribeIamInstanceProfileAssociations",
                "ec2:DisassociateIamInstanceProfile",
                "iam:GetRole",
                "iam:TagRole",
                "iam:ListRoles",
                "kms:ListAliases"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "ec2:TerminateInstances"
            ],
            "Condition": {
                "StringLike": {
                    "ec2:ResourceTag/OCCMInstance": "*"
                }
            },
            "Resource": [
                "arn:aws:ec2:*:*:instance/*"
            ]
        }
    ]
}
----
. 单击*下一步*并根据需要添加标记。
. 单击*下一步*并输入名称和问题描述。
. 单击*创建策略*。


.下一步是什么？
将策略附加到BlueXP可以承担的IAM角色或IAM用户。



=== 设置 IAM 角色

设置一个IAM角色、BlueXP可以承担此角色、以便在AWS中部署Connector。

.步骤
. 转到目标帐户中的 AWS IAM 控制台。
. 在访问管理下，单击 * 角色 > 创建角色 * ，然后按照步骤创建角色。
+
请务必执行以下操作：

+
** 在 * 可信实体类型 * 下，选择 * AWS 帐户 * 。
** 选择*其他AWS帐户*、然后输入BlueXP SaaS帐户的ID：952013314444
** 选择在上一节中创建的策略。


. 创建角色后、复制角色ARN、以便您可以在创建Connector时将其粘贴到BlueXP中。


.结果
IAM 角色现在具有所需的权限。



=== 为 IAM 用户设置权限

创建 Connector 时，您可以为拥有部署 Connector 实例所需权限的 IAM 用户提供 AWS 访问密钥和机密密钥。

.步骤
. 在AWS IAM控制台中、单击*用户*、然后选择用户名。
. 单击*添加权限>直接附加现有策略*。
. 选择创建的策略。
. 单击*下一步*、然后单击*添加权限*。
. 确保您有权访问 IAM 用户的访问密钥和机密密钥。


.结果
AWS用户现在具有从BlueXP创建Connector所需的权限。在BlueXP提示时、您需要为此用户指定AWS访问密钥。



== 设置网络

设置您的网络，以便 Connector 可以管理公有云环境中的资源和流程。除了为Connector提供虚拟网络和子网之外、您还需要确保满足以下要求。



=== 连接到目标网络

Connector需要与您要创建的工作环境类型以及计划启用的服务建立网络连接。

例如、如果您在公司网络中安装了连接器、则必须设置与启动Cloud Volumes ONTAP 的虚拟网络的VPN连接。



=== 出站 Internet 访问

连接器需要通过出站 Internet 访问来管理公有云环境中的资源和流程。

[cols="2*"]
|===
| 端点 | 目的 


| \https：//https <region> ：//__LW_AT__.amazonaws.com | 管理AWS中的资源。 


| https://support.netapp.com | 获取许可信息并向 NetApp 支持部门发送 AutoSupport 消息。 


 a| 
https://*.api.bluexp.netapp.com

https://api.bluexp.netapp.com

https://*.cloudmanager.cloud.netapp.com

https://cloudmanager.cloud.netapp.com
 a| 
在BlueXP中提供SaaS功能和服务。


NOTE: Connector当前正在联系cloudmanager.cloud.netapp.com"、但在即将发布的版本中、它将开始联系api.bluexp.netapp.com"。



| https://cloudmanagerinfraprod.azurecr.io \https://*.blob.core.windows.net | 升级 Connector 及其 Docker 组件。 
|===


=== 代理服务器

如果您的组织要求为所有传出Internet流量部署代理服务器、请获取有关HTTP或HTTPS代理的以下信息：

* IP 地址
* 凭据
* HTTPS证书




=== 安全组

没有传入到连接器的流量、除非您启动该流量、或者该连接器用作AutoSupport 消息的代理。HTTP 和 HTTPS 可用于访问 https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-connectors.html#the-local-user-interface["本地 UI"]，在极少数情况下使用。只有在需要连接到主机进行故障排除时，才需要使用 SSH 。



=== IP地址限制

可能与172范围内的IP地址冲突。 https://docs.netapp.com/us-en/cloud-manager-setup-admin/reference-limitations.html["了解有关此限制的更多信息"]。



== 创建连接器

通过BlueXP、您可以直接从其用户界面在AWS中创建Connector。

.步骤
. 如果要创建首个工作环境，请单击 * 添加工作环境 * 并按照提示进行操作。否则，请单击 * 连接器 * 下拉列表并选择 * 添加连接器 * 。
+
image:screenshot_connector_add.gif["标题中显示 Connector 图标和 Add Connector 操作的屏幕截图。"]

. 选择 * Amazon Web Services* 作为您的云提供商，然后单击 * 继续 * 。
. 在*部署Connector*页面上、查看有关所需内容的详细信息。您有两种选择：
+
.. 单击*继续*以使用产品指南为部署做准备。产品指南中的每个步骤都包含文档本页中包含的信息。
.. 如果您已按照此页面上的步骤做好准备、请单击*跳至部署*。


. 按照向导中的步骤创建 Connector ：
+
** * 准备就绪 * ：查看您需要的内容。
** * AWS Credentials*：指定您的AWS区域、然后选择身份验证方法、即BlueXP可以承担的IAM角色或AWS访问密钥和机密密钥。
+

TIP: 如果选择 * 承担角色 * ，则可以从 Connector 部署向导创建第一组凭据。必须从 " 凭据 " 页面创建任何其他凭据集。然后，这些文件将从向导的下拉列表中显示。 link:task-adding-aws-accounts.html["了解如何添加其他凭据"]。

** * 详细信息 * ：提供有关连接器的详细信息。
+
*** 输入实例的名称。
*** 向实例添加自定义标记（元数据）。
*** 选择是希望BlueXP创建具有所需权限的新角色、还是要选择使用设置的现有角色 link:reference-permissions-aws.html["所需权限"]。
*** 选择是否要对 Connector 的 EBS 磁盘进行加密。您可以选择使用默认加密密钥或自定义密钥。


** *网络*：指定实例的VPC、子网和密钥对、选择是否启用公共IP地址、并可选择指定代理配置(支持HTTP和HTTPS)。
+
确保您具有可用于Connector的正确密钥对。如果没有密钥对、您将无法访问Connector虚拟机。

** * 安全组 * ：选择是创建新的安全组，还是选择允许入站 HTTP ， HTTPS 和 SSH 访问的现有安全组。
** * 审核 * ：查看您选择的内容，确认您的设置正确无误。


. 单击 * 添加 * 。
+
此实例应在大约 7 分钟后准备就绪。您应停留在页面上，直到此过程完成。



.完成后
如果您在创建Connector的同一AWS帐户中有Amazon S3存储分段、则会在Canvas上自动显示Amazon S3工作环境。 link:task-viewing-amazon-s3.html["详细了解如何使用此工作环境"]。



== 打开端口3128以显示AutoSupport 消息

如果您计划在出站Internet连接不可用的子网中部署Cloud Volumes ONTAP 系统、则BlueXP会自动将Cloud Volumes ONTAP 配置为使用此连接器作为代理服务器。

唯一的要求是确保Connector的安全组允许通过端口3128进行_inbound_连接。部署Connector后、您需要打开此端口。

如果对Cloud Volumes ONTAP 使用默认安全组、则不需要对其安全组进行任何更改。但是、如果您计划为Cloud Volumes ONTAP 定义严格的出站规则、则还需要确保Cloud Volumes ONTAP 安全组允许通过端口3128进行_outout_连接。
